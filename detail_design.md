# 美術史人物相関図作成アプリ 詳細設計

## 1. 概要
`design.md`の仕様を元に、実現可能性と保守性を考慮した具体的な設計案。
美術史の人物とその関係性を視覚的に把握するためのWebアプリケーションを開発する。

## 2. 技術スタック
保守性と開発効率を重視し、モダンなWeb技術を採用する。

- **フロントエンドフレームワーク:** **React (Next.js)**
  - 理由: コンポーネントベースでの開発に適しており、UIの部品化が容易。エコシステムが豊富で、セットアップも簡単。
- **グラフ描画ライブラリ:** **React Flow**
  - 理由: ノードのドラッグ＆ドロップ、ズーム、接続線のカスタマイズ、自動レイアウトなど、要求仕様を満たす機能が豊富に揃っている。
- **データ管理:**
  - **初期段階:** **JSONファイル**
    - 理由: データ数がO(10^3)程度であれば、外部データベースは不要。まずは静的なJSONファイルを読み込む形式で迅速に開発を進める。データの追加・編集は、クライアントサイドで完結させ、JSONファイルとしてエクスポートする機能で対応する。
  - **将来的な拡張:** **Supabase / Firebase (BaaS)**
    - 理由: 複数人での利用や、より高度なデータ管理機能が必要になった際に、サーバー管理の手間なくデータベースやAPIを導入できるため。

## 3. 設計詳細

### 3.1. データ構造 (JSON形式)
人物（ノード）と関係（エッジ）をそれぞれ別のJSONファイルで管理する。

- **`nodes.json`** (人物データ)
  ```json
  [
    {
      "id": "1",
      "type": "custom",
      "data": { "label": "レオナルド・ダ・ヴィンチ", "era": "盛期ルネサンス" },
      "position": { "x": 250, "y": 5 }
    },
    {
      "id": "2",
      "type": "custom",
      "data": { "label": "ヴェロッキオ", "era": "初期ルネサンス" },
      "position": { "x": 100, "y": 100 }
    },
    {
      "id": "3",
      "type": "custom",
      "data": { "label": "ミケランジェロ", "era": "盛期ルネサンス" },
      "position": { "x": 400, "y": 100 }
    }
  ]
  ```

- **`edges.json`** (関係データ)
  ```json
  [
    {
      "id": "e2-1",
      "source": "2",
      "target": "1",
      "label": "師匠"
    },
    {
      "id": "e1-3",
      "source": "1",
      "target": "3",
      "label": "ライバル"
    }
  ]
  ```

### 3.2. 画面構成（コンポーネント案）
アプリケーションは、大きく分けて2つの領域で構成される。

- **`GraphView` (メイン領域)**
  - React Flowコンポーネントを配置し、人物相関図を描画する。
  - ズーム、パン、ノードのドラッグ操作が可能。

- **`Sidebar` (サイドバー領域)**
  - 以下の機能コンポーネントを配置する。
  - **`SearchForm`:** 人物名でグラフ上のノードを検索し、ハイライトする。
  - **`NodeDetail`:** クリックしたノード（人物）の詳細情報を表示する。
  - **`AddForm`:** 新しい人物（ノード）や関係（エッジ）を追加するためのフォーム。（フェーズ2以降）
  - **`Filter`:** 時代（`era`）などで表示する人物を絞り込むためのUI。（フェーズ3以降）

## 4. 開発ステップ案
提案した設計に基づき、以下のステップで開発を進める。

- **ステップ1 (フェーズ1の実現):**
  1. `npx create-next-app` でNext.jsプロジェクトを初期化する。
  2. `npm install react-flow` でReact Flowをプロジェクトに追加する。
  3. サンプルデータとして `nodes.json` と `edges.json` を手動で作成する。
  4. アプリケーション起動時に上記JSONファイルを読み込み、React Flowのキャンバスにグラフとして表示する。
  5. ノードのドラッグやズームなどの基本操作ができることを確認する。

- **ステップ2 (フェーズ2の準備):**
  1. サイドバーに、新しい人物と関係を追加するためのUIフォーム (`AddForm`) を作成する。
  2. 「追加」ボタンを押すと、フォームの内容がReact Flowのグラフに反映されるロジックを実装する（状態管理のみ）。
  3. 「JSONダウンロード」ボタンを設置し、現在のグラフの状態（ノードとエッジの全データ）を新しいJSONファイルとしてクライアントサイドで生成し、ダウンロードさせる機能を実装する。
